{% extends 'base.html' %}
{% load static %}

{% block body %}

    <div class="container py-5">
        <h1 class="mb-5 text-center" style="color: var(--primary-orange);">Categorías de Álbumes</h1>

        <!-- Barra de búsqueda (mantenida de la versión anterior) -->
        <div class="mb-4">
            <input type="text" id="searchInput" class="form-control form-control-lg"
                   placeholder="Buscar categoría por nombre...">
        </div>

        {% if categorias %}
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4" id="categoryGrid">
                {% for cat in categorias %}
                    <div class="col category-card">
                        <!-- Enlace a la vista de ranking por categoría -->
                        <a href="{% url 'rankingApp:ranking' category_code=cat.code %}"
                           class="text-decoration-none">
                            <div class="card h-100 shadow-sm border-0 text-center"
                                 style="transition: transform 0.2s; cursor: pointer;">
                                <!-- Logo -->
                                {% if cat.logo %}
                                    <img src="{{ cat.logo }}" class="card-img-top mx-auto mt-3" alt="{{ cat.name }}"
                                         style="width: 120px; height: 120px; object-fit: contain;">
                                {% else %}
                                    <img src="{% static 'img/no-logo.png' %}" class="card-img-top mx-auto mt-3" alt="Sin logo"
                                         style="width: 120px; height: 120px; object-fit: contain;">
                                {% endif %}

                                <!-- Nombre -->
                                <div class="card-body">
                                    <h5 class="card-title fw-bold category-name" style="color: var(--primary-orange);">
                                        {{ cat.name }}
                                    </h5>
                                    {% if cat.description %}
                                        <p class="card-text text-muted small">
                                            {{ cat.description|truncatewords:15 }}
                                        </p>
                                    {% endif %}
                                </div>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            </div>

            <div id="noResults" class="alert alert-info text-center py-4 mt-4" style="display: none;">
                <h4>No se encontraron categorías que coincidan con la búsqueda.</h4>
            </div>
        {% else %}
            <div class="alert alert-info text-center py-4">
                <h4>No hay categorías disponibles en este momento.</h4>
            </div>
        {% endif %}
    </div>

    <!-- JavaScript para el filtro en tiempo real -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById('searchInput');
            const categoryCards = document.querySelectorAll('.category-card');
            const noResults = document.getElementById('noResults');

            searchInput.addEventListener('input', function () {
                const filter = searchInput.value.toLowerCase().trim();
                let visibleCount = 0;

                categoryCards.forEach(function (card) {
                    const name = card.querySelector('.category-name').textContent.toLowerCase();
                    if (name.includes(filter)) {
                        card.style.display = '';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });

                // Mostrar/ocultar mensaje de "sin resultados"
                if (visibleCount === 0 && filter !== '') {
                    noResults.style.display = 'block';
                } else {
                    noResults.style.display = 'none';
                }
            });
        });
    </script>

{% endblock %}